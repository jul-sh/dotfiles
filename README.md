# dotfiles

My personal dotfiles and system configuration, managed declaratively with Nix and Home Manager.

## Quick Start

```bash
mkdir -p ~/git && git clone https://github.com/jul-sh/dotfiles.git ~/git/dotfiles && cd ~/git/dotfiles && ./setup.sh
```

This will:
1. Install Nix (supports both multi-user and single-user modes)
2. Apply Home Manager configuration (packages + dotfiles)
3. Create local shell rc files for machine-specific customizations
4. Install GUI applications (Raycast, Zed)
5. Configure macOS system settings

## Architecture

### Nix-Managed Shared Configuration
- `.profile.shared`, `.bashrc.shared`, `.zshrc.shared` - Generated by Home Manager
- Packages declared in `nix/home.nix`
- Reproducible across machines

### Local Machine-Specific Configuration
- `.profile`, `.bashrc`, `.zshrc` - Created once by setup.sh, then owned by you
- Untracked by git
- Safe for software installers to modify

### The Flow
```
Local .zshrc (machine-specific)
  └─> sources .zshrc.shared (Nix-managed)
       └─> sources .profile.shared (Nix-managed)
```

Software installers can safely append to local files without:
- Conflicting with Home Manager
- Creating git changes
- Breaking reproducibility

## Migrating Existing Installations

If you have an old installation (pre-Nix or with symlinked dotfiles), run:

```bash
cd ~/git/dotfiles
git pull
./migrate_shell_configs.sh
```

This comprehensive migration script will:
1. Extract and preserve your machine-specific PATH exports and customizations
2. Install Nix (tries multi-user, falls back to single-user)
3. Apply Home Manager configuration (generates .shared files)
4. Create local rc files with your preserved machine-specific config
5. Install GUI applications and configure OS settings

Your existing machine-specific configurations will be preserved and moved to the local rc files.

## Updating

To update packages and configuration:

```bash
cd ~/git/dotfiles
git pull
nix flake update  # Update package versions (optional)
home-manager switch --flake ./nix#${USER}@$(uname -m)-$(uname -s | tr '[:upper:]' '[:lower:]')
```
